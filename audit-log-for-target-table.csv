
BATCH_ID,SP_NAME,STATUS,START_TIME,END_TIME,DESCRIPTION,SQL,ROWS_AFFECTED,EXECUTING_USER
2023-12-04 12:41:01.428 +0530-2,AUDITLOG,RUNNING,2023-12-04T12:41:01.428Z,1970-01-01T05:30:00Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    ",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-152,AUDITLOG,SUCCESS,2023-12-04T12:30:13.768Z,2023-12-04T12:30:14.335Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-126,AUDITLOG,SUCCESS,2023-12-04T12:33:11.719Z,2023-12-04T12:33:12.468Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","INSERT INTO TargetTable (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal,
    EDH_ROW_HASH_NBR, EDH_DML_IND, EDH_IS_C_FLG,
    EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00,
    12345, 'I', true,
    '1', '123', 'JohnDoe'
);",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-151,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:13.768Z,2023-12-04T12:30:14.335Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-153,AUDITLOG,SUCCESS,2023-12-04T12:30:11.318Z,2023-12-04T12:30:12.567Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-125,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:11.719Z,2023-12-04T12:33:12.468Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","INSERT INTO TargetTable (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal,
    EDH_ROW_HASH_NBR, EDH_DML_IND, EDH_IS_C_FLG,
    EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00,
    12345, 'I', true,
    '1', '123', 'JohnDoe'
);",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-127,AUDITLOG,SUCCESS,2023-12-04T12:32:39.595Z,2023-12-04T12:32:39.719Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  COUNT(""TARGETTABLE"".""CATEGORYNAME"") AS ""cnt:CATEGORYNAME:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1",34,MINIPROJECT
2023-12-04 12:41:01.428 +0530-52,AUDITLOG,SUCCESS,2023-12-04T12:39:32.562Z,2023-12-04T12:39:34.64Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","INSERT INTO SalesFact (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
    , ShipDate, DueDate, CustomerId, CustomerName
    , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
    , CategoryName, SubCategoryName, VendorID, VendorName
    , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
    , DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthYear, MonthName, WEEK, WeekName, Year
    , DeliveryTAT, ShipmentStatus, ProductType, OrderValue, TaxAmount
    , FreightAmount, ExtendedAmount, SubTotal
)
-- Create CTE (Common Table Expression) to perform transformations on data from multiple tables
WITH Transformations AS (
	-- Select and transform data from various joined tables
    SELECT
        o.SalesOrderID AS OrderId
        , o.OrderDate
        , o.OrderQty
        , o.UnitPrice
        , o.UnitPriceDiscount
        , o.ShipDate
        , o.DueDate
        , c.CustomerId AS CustomerId
        , c.FullName AS CustomerName
        , p.ProductId
        , p.ProductName
        , p.ModelName
        , p.MakeFlag
        , p.StandardCost
        , p.ListPrice
        , pc.CategoryName
        , psc.SubCategoryName
        , vp.VendorID
        , v.VendorName
        , v.AccountNumber AS VendorAccountNumber
        , v.CreditRating AS VendorCreditRating
        , v.ActiveFlag AS VendorActiveFlag
        
        --DAYTYPE
        , CASE WHEN DAYOFWEEK(o.OrderDate) IN (2, 3, 4, 5, 6) THEN 'Weekday' ELSE 'Weekend' END AS DayType
        
        --DAY
        , CASE 
            WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
            WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
            WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
            WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
            WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
            WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
            WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
        END AS Day
        
        --DAYSHORT
        , DAYNAME(Orderdate) AS DayShort

        --QUATER
        , CASE 
            WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
            WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
            WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
            WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
        END AS Quarter
        
        --QUATERYEAR
        , CONCAT(YEAR(OrderDate), '-Q',
            CASE 
                WHEN QUARTER(OrderDate) = 1 THEN '1'
                WHEN QUARTER(OrderDate) = 2 THEN '2'
                WHEN QUARTER(OrderDate) = 3 THEN '3'
                WHEN QUARTER(OrderDate) = 4 THEN '4'
            END) AS QuarterYear
            
        --MONTH
        , MONTH(OrderDate) AS Month
        
        --MONTHNAME
        , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
        
        --MONTHYEAR
        , CONCAT(YEAR(OrderDate), '-', MONTH(OrderDate)) AS MonthYear
        
        --WEEK
        , CEIL(DAY(orderdate) / 7) AS week
        
        --WEEKNAME
        , CONCAT('Wk-' || CEIL(DAY(ORDERDATE) / 7)) AS WEEK
    
        --YEAR
        , YEAR(ORDERDATE) AS YEAR
        
        --DeliveryTAT
        , DATEDIFF(day,ORDERDATE,SHIPDATE) AS DeliveryTAT
        
        --ShipmentStatus
        , CASE
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                WHEN ShipDate > DueDate THEN 'Late'
        END AS ShipmentStatus
            
        --ProductType
        , CASE
            WHEN MakeFlag=1 THEN 'Manufactured'
            WHEN MakeFlag=0 THEN 'Purchased'
        END AS ProductType

        --OrderValue
        , OrderQty * (UnitPrice - (UnitPrice * UnitPriceDiscount)) AS OrderValue

        -- TaxAmount
        , o.taxamt / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID) AS TaxAmount
        
        --FreightAmount    
        , o.freight / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID) AS FreightAmount

        --ExtendedAmount
        , (OrderQty * (UnitPrice - (UnitPrice * UnitPriceDiscount))) + (o.taxamt / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) + (o.freight / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS ExtendedAmount
            
        FROM
            Orders o
            JOIN Customers c ON o.CustomerID = c.CustomerID
            JOIN Products p ON o.ProductID = p.ProductID
            JOIN ProductSubCategories psc ON p.SubCategoryID = psc.SubCategoryID
            JOIN ProductCategories pc ON psc.CategoryID = pc.CategoryID
            JOIN VendorProduct vp ON p.ProductID = vp.ProductID
            JOIN Vendors v ON vp.VendorID = v.VendorID
)

SELECT
    * -- Select all columns
    -- SubTotal
    , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
FROM
    Transformations;",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-1,EDH_PROCEDURE,RUNNING,2023-12-04T12:41:01.428Z,1970-01-01T05:30:00Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    ",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-3,AUDITLOG,RUNNING,2023-12-04T12:41:01.375Z,1970-01-01T05:30:00Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL AuditLog();,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-128,EDH_PROCEDURE,SUCCESS,2023-12-04T12:32:39.595Z,2023-12-04T12:32:39.719Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  COUNT(""TARGETTABLE"".""CATEGORYNAME"") AS ""cnt:CATEGORYNAME:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1",34,MINIPROJECT
2023-12-04 12:41:01.428 +0530-129,AUDITLOG,SUCCESS,2023-12-04T12:32:29.19Z,2023-12-04T12:32:29.26Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""CATEGORYNAME"" AS ""CATEGORYNAME"",
  ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2",79,MINIPROJECT
2023-12-04 12:41:01.428 +0530-4,EDH_PROCEDURE,RUNNING,2023-12-04T12:41:01.375Z,1970-01-01T05:30:00Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL AuditLog();,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-5,AUDITLOG,SUCCESS,2023-12-04T12:40:59.857Z,2023-12-04T12:41:01.094Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-154,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:11.318Z,2023-12-04T12:30:12.567Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-155,AUDITLOG,SUCCESS,2023-12-04T12:30:10.427Z,2023-12-04T12:30:11.291Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-51,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:32.562Z,2023-12-04T12:39:34.64Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","INSERT INTO SalesFact (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
    , ShipDate, DueDate, CustomerId, CustomerName
    , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
    , CategoryName, SubCategoryName, VendorID, VendorName
    , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
    , DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthYear, MonthName, WEEK, WeekName, Year
    , DeliveryTAT, ShipmentStatus, ProductType, OrderValue, TaxAmount
    , FreightAmount, ExtendedAmount, SubTotal
)
-- Create CTE (Common Table Expression) to perform transformations on data from multiple tables
WITH Transformations AS (
	-- Select and transform data from various joined tables
    SELECT
        o.SalesOrderID AS OrderId
        , o.OrderDate
        , o.OrderQty
        , o.UnitPrice
        , o.UnitPriceDiscount
        , o.ShipDate
        , o.DueDate
        , c.CustomerId AS CustomerId
        , c.FullName AS CustomerName
        , p.ProductId
        , p.ProductName
        , p.ModelName
        , p.MakeFlag
        , p.StandardCost
        , p.ListPrice
        , pc.CategoryName
        , psc.SubCategoryName
        , vp.VendorID
        , v.VendorName
        , v.AccountNumber AS VendorAccountNumber
        , v.CreditRating AS VendorCreditRating
        , v.ActiveFlag AS VendorActiveFlag
        
        --DAYTYPE
        , CASE WHEN DAYOFWEEK(o.OrderDate) IN (2, 3, 4, 5, 6) THEN 'Weekday' ELSE 'Weekend' END AS DayType
        
        --DAY
        , CASE 
            WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
            WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
            WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
            WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
            WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
            WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
            WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
        END AS Day
        
        --DAYSHORT
        , DAYNAME(Orderdate) AS DayShort

        --QUATER
        , CASE 
            WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
            WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
            WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
            WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
        END AS Quarter
        
        --QUATERYEAR
        , CONCAT(YEAR(OrderDate), '-Q',
            CASE 
                WHEN QUARTER(OrderDate) = 1 THEN '1'
                WHEN QUARTER(OrderDate) = 2 THEN '2'
                WHEN QUARTER(OrderDate) = 3 THEN '3'
                WHEN QUARTER(OrderDate) = 4 THEN '4'
            END) AS QuarterYear
            
        --MONTH
        , MONTH(OrderDate) AS Month
        
        --MONTHNAME
        , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
        
        --MONTHYEAR
        , CONCAT(YEAR(OrderDate), '-', MONTH(OrderDate)) AS MonthYear
        
        --WEEK
        , CEIL(DAY(orderdate) / 7) AS week
        
        --WEEKNAME
        , CONCAT('Wk-' || CEIL(DAY(ORDERDATE) / 7)) AS WEEK
    
        --YEAR
        , YEAR(ORDERDATE) AS YEAR
        
        --DeliveryTAT
        , DATEDIFF(day,ORDERDATE,SHIPDATE) AS DeliveryTAT
        
        --ShipmentStatus
        , CASE
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                WHEN ShipDate > DueDate THEN 'Late'
        END AS ShipmentStatus
            
        --ProductType
        , CASE
            WHEN MakeFlag=1 THEN 'Manufactured'
            WHEN MakeFlag=0 THEN 'Purchased'
        END AS ProductType

        --OrderValue
        , OrderQty * (UnitPrice - (UnitPrice * UnitPriceDiscount)) AS OrderValue

        -- TaxAmount
        , o.taxamt / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID) AS TaxAmount
        
        --FreightAmount    
        , o.freight / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID) AS FreightAmount

        --ExtendedAmount
        , (OrderQty * (UnitPrice - (UnitPrice * UnitPriceDiscount))) + (o.taxamt / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) + (o.freight / COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS ExtendedAmount
            
        FROM
            Orders o
            JOIN Customers c ON o.CustomerID = c.CustomerID
            JOIN Products p ON o.ProductID = p.ProductID
            JOIN ProductSubCategories psc ON p.SubCategoryID = psc.SubCategoryID
            JOIN ProductCategories pc ON psc.CategoryID = pc.CategoryID
            JOIN VendorProduct vp ON p.ProductID = vp.ProductID
            JOIN Vendors v ON vp.VendorID = v.VendorID
)

SELECT
    * -- Select all columns
    -- SubTotal
    , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
FROM
    Transformations;",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-130,EDH_PROCEDURE,SUCCESS,2023-12-04T12:32:29.19Z,2023-12-04T12:32:29.26Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""CATEGORYNAME"" AS ""CATEGORYNAME"",
  ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2",79,MINIPROJECT
2023-12-04 12:41:01.428 +0530-131,AUDITLOG,SUCCESS,2023-12-04T12:32:15.987Z,2023-12-04T12:32:16.05Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-102,AUDITLOG,SUCCESS,2023-12-04T12:34:59.718Z,2023-12-04T12:34:59.778Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4,
  6",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-6,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:59.857Z,2023-12-04T12:41:01.094Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-7,AUDITLOG,SUCCESS,2023-12-04T12:40:59.129Z,2023-12-04T12:40:59.835Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-156,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:10.427Z,2023-12-04T12:30:11.291Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-157,AUDITLOG,SUCCESS,2023-12-04T12:30:09.861Z,2023-12-04T12:30:10.368Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-53,AUDITLOG,SUCCESS,2023-12-04T12:39:31.262Z,2023-12-04T12:39:31.485Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE TABLE SalesFact (
    SeqNo INT IDENTITY(1,1) PRIMARY KEY -- Sequential identifier for the sales facts
	
    -- Columns related to order details
    , OrderId INT -- Unique identifier for the order
    , OrderDate DATE -- Date of the order
    , OrderQty INT -- Quantity of products ordered
    , UnitPrice DECIMAL(18,2) -- Price per unit of the product
    , UnitPriceDiscount DECIMAL(18,2) -- Discount on unit price
    , ShipDate DATE -- Date of shipment
    , DueDate DATE -- Due date for the order
    , CustomerId INT -- Identifier for the customer
    , CustomerName VARCHAR() -- Name of the customer
	
    -- Columns related to product details
    , ProductId INT -- Identifier for the product
    , ProductName VARCHAR() -- Name of the product
    , ModelName VARCHAR() -- Model of the product
    , MakeFlag BOOLEAN -- Indicates if the product is manufactured
    , StandardCost DECIMAL(18,2) -- Standard cost of the product
    , ListPrice DECIMAL(18,2) -- List price of the product
    , CategoryName VARCHAR() -- Name of the product category
    , SubCategoryName VARCHAR() -- Name of the product sub-category
	
    -- Columns related to vendor details
    , VendorID INT -- Identifier for the vendor
    , VendorName VARCHAR() -- Name of the vendor
    , VendorAccountNumber VARCHAR() -- Account number of the vendor
    , VendorCreditRating INT -- Credit rating of the vendor
    , VendorActiveFlag BOOLEAN -- Indicates if the vendor is active
	
    -- Columns related to date and time dimensions
    , DayType VARCHAR() -- Type of day (Weekday/Weekend)
    , Day VARCHAR() -- Day of the week
    , DayShort VARCHAR() -- Short representation of the day
    , Quarter VARCHAR() -- Quarter of the year
    , QuarterYear VARCHAR() -- Year and quarter combination
    , Month INT -- Month number
    , MonthName VARCHAR() -- Name of the month
    , MonthYear VARCHAR() -- Year and month combination
    , Week INT -- Week number
    , WeekName VARCHAR() -- Name of the week
    , Year INT -- Year
	
    -- Additional columns related to delivery and shipment details
    , DeliveryTAT INT -- Delivery Turnaround Time
    , ShipmentStatus VARCHAR() -- Status of the shipment (Early/Normal/Late)
    , ProductType VARCHAR() -- Type of the product (Manufactured/Purchased)
	
    -- Financial columns
    , OrderValue DECIMAL(18,2) -- Total value of the order
    , TaxAmount DECIMAL(18,2) -- Tax amount
    , FreightAmount DECIMAL(18,2) -- Freight amount
    , ExtendedAmount DECIMAL(18,2) -- Extended amount including tax and freight
    , SubTotal DECIMAL(18,2) -- Subtotal amount
	
	-- Enterprise Data Hub (EDH) columns
    , EDH_ROW_HASH_NBR INT
    , EDH_DML_IND VARCHAR()
    , EDH_CREAT_TS DATETIME DEFAULT current_timestamp()
    , EDH_UPDT_TS DATETIME DEFAULT TO_TIMESTAMP('9999-01-01 12:00:00', 'YYYY-MM-DD HH24:MI:SS')
    , EDH_IS_C_FLG BOOLEAN
    , EDH_REPLICATION_SEQUENCE_NUMBER VARCHAR() DEFAULT '0'
    , EDH_LINEAGE_ID VARCHAR() DEFAULT '0'
    , EDH_MODIFIED_BY_USER_NAME NVARCHAR(255) DEFAULT current_user()
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-8,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:59.129Z,2023-12-04T12:40:59.835Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-158,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:09.861Z,2023-12-04T12:30:10.368Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-159,AUDITLOG,SUCCESS,2023-12-04T12:30:09.569Z,2023-12-04T12:30:09.771Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-54,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:31.262Z,2023-12-04T12:39:31.485Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE TABLE SalesFact (
    SeqNo INT IDENTITY(1,1) PRIMARY KEY -- Sequential identifier for the sales facts
	
    -- Columns related to order details
    , OrderId INT -- Unique identifier for the order
    , OrderDate DATE -- Date of the order
    , OrderQty INT -- Quantity of products ordered
    , UnitPrice DECIMAL(18,2) -- Price per unit of the product
    , UnitPriceDiscount DECIMAL(18,2) -- Discount on unit price
    , ShipDate DATE -- Date of shipment
    , DueDate DATE -- Due date for the order
    , CustomerId INT -- Identifier for the customer
    , CustomerName VARCHAR() -- Name of the customer
	
    -- Columns related to product details
    , ProductId INT -- Identifier for the product
    , ProductName VARCHAR() -- Name of the product
    , ModelName VARCHAR() -- Model of the product
    , MakeFlag BOOLEAN -- Indicates if the product is manufactured
    , StandardCost DECIMAL(18,2) -- Standard cost of the product
    , ListPrice DECIMAL(18,2) -- List price of the product
    , CategoryName VARCHAR() -- Name of the product category
    , SubCategoryName VARCHAR() -- Name of the product sub-category
	
    -- Columns related to vendor details
    , VendorID INT -- Identifier for the vendor
    , VendorName VARCHAR() -- Name of the vendor
    , VendorAccountNumber VARCHAR() -- Account number of the vendor
    , VendorCreditRating INT -- Credit rating of the vendor
    , VendorActiveFlag BOOLEAN -- Indicates if the vendor is active
	
    -- Columns related to date and time dimensions
    , DayType VARCHAR() -- Type of day (Weekday/Weekend)
    , Day VARCHAR() -- Day of the week
    , DayShort VARCHAR() -- Short representation of the day
    , Quarter VARCHAR() -- Quarter of the year
    , QuarterYear VARCHAR() -- Year and quarter combination
    , Month INT -- Month number
    , MonthName VARCHAR() -- Name of the month
    , MonthYear VARCHAR() -- Year and month combination
    , Week INT -- Week number
    , WeekName VARCHAR() -- Name of the week
    , Year INT -- Year
	
    -- Additional columns related to delivery and shipment details
    , DeliveryTAT INT -- Delivery Turnaround Time
    , ShipmentStatus VARCHAR() -- Status of the shipment (Early/Normal/Late)
    , ProductType VARCHAR() -- Type of the product (Manufactured/Purchased)
	
    -- Financial columns
    , OrderValue DECIMAL(18,2) -- Total value of the order
    , TaxAmount DECIMAL(18,2) -- Tax amount
    , FreightAmount DECIMAL(18,2) -- Freight amount
    , ExtendedAmount DECIMAL(18,2) -- Extended amount including tax and freight
    , SubTotal DECIMAL(18,2) -- Subtotal amount
	
	-- Enterprise Data Hub (EDH) columns
    , EDH_ROW_HASH_NBR INT
    , EDH_DML_IND VARCHAR()
    , EDH_CREAT_TS DATETIME DEFAULT current_timestamp()
    , EDH_UPDT_TS DATETIME DEFAULT TO_TIMESTAMP('9999-01-01 12:00:00', 'YYYY-MM-DD HH24:MI:SS')
    , EDH_IS_C_FLG BOOLEAN
    , EDH_REPLICATION_SEQUENCE_NUMBER VARCHAR() DEFAULT '0'
    , EDH_LINEAGE_ID VARCHAR() DEFAULT '0'
    , EDH_MODIFIED_BY_USER_NAME NVARCHAR(255) DEFAULT current_user()
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-55,AUDITLOG,SUCCESS,2023-12-04T12:39:17.671Z,2023-12-04T12:39:17.804Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""SUBCATEGORYNAME"" AS ""SUBCATEGORYNAME"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4",335,MINIPROJECT
2023-12-04 12:41:01.428 +0530-9,AUDITLOG,SUCCESS,2023-12-04T12:40:58.627Z,2023-12-04T12:40:59.082Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-160,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:09.569Z,2023-12-04T12:30:09.771Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-56,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:17.671Z,2023-12-04T12:39:17.804Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""SUBCATEGORYNAME"" AS ""SUBCATEGORYNAME"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4",335,MINIPROJECT
2023-12-04 12:41:01.428 +0530-57,AUDITLOG,SUCCESS,2023-12-04T12:36:10.407Z,2023-12-04T12:36:10.979Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22151,MINIPROJECT
2023-12-04 12:41:01.428 +0530-26,AUDITLOG,SUCCESS,2023-12-04T12:40:56.186Z,2023-12-04T12:40:56.322Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE TABLE AuditTable (
    Batch_ID STRING PRIMARY KEY, -- Unique identifier for each audit batch
    SP_Name STRING, -- Name of the stored procedure executed
    Status STRING, -- Execution status of the procedure
    Start_Time TIMESTAMP_NTZ, -- Start time of the procedure execution
    End_Time TIMESTAMP_NTZ, -- End time of the procedure execution
    Description STRING, -- Description or definition of the procedure
    SQL STRING, -- SQL query executed
    Rows_affected NUMBER, -- Number of rows affected by the query
    Executing_User STRING -- User executing the procedure
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-58,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:10.407Z,2023-12-04T12:36:10.979Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22151,MINIPROJECT
2023-12-04 12:41:01.428 +0530-161,AUDITLOG,SUCCESS,2023-12-04T12:30:09.288Z,2023-12-04T12:30:09.507Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-101,EDH_PROCEDURE,SUCCESS,2023-12-04T12:34:59.718Z,2023-12-04T12:34:59.778Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4,
  6",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-103,AUDITLOG,SUCCESS,2023-12-04T12:34:56.517Z,2023-12-04T12:34:56.692Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  5",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-59,AUDITLOG,SUCCESS,2023-12-04T12:36:07.463Z,2023-12-04T12:36:09.073Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22151,MINIPROJECT
2023-12-04 12:41:01.428 +0530-162,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:09.288Z,2023-12-04T12:30:09.507Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-163,AUDITLOG,SUCCESS,2023-12-04T12:30:08.793Z,2023-12-04T12:30:09.115Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-104,EDH_PROCEDURE,SUCCESS,2023-12-04T12:34:56.517Z,2023-12-04T12:34:56.692Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  5",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-105,AUDITLOG,SUCCESS,2023-12-04T12:34:19.898Z,2023-12-04T12:34:20.071Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  4",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-60,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:07.463Z,2023-12-04T12:36:09.073Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22151,MINIPROJECT
2023-12-04 12:41:01.428 +0530-61,AUDITLOG,SUCCESS,2023-12-04T12:36:06.53Z,2023-12-04T12:36:07.384Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-164,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:08.793Z,2023-12-04T12:30:09.115Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-106,EDH_PROCEDURE,SUCCESS,2023-12-04T12:34:19.898Z,2023-12-04T12:34:20.071Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  4",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-107,AUDITLOG,SUCCESS,2023-12-04T12:33:28.829Z,2023-12-04T12:33:29.713Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-62,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:06.53Z,2023-12-04T12:36:07.384Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-108,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:28.829Z,2023-12-04T12:33:29.713Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-165,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:08.667Z,2023-12-04T12:30:12.592Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-166,AUDITLOG,SUCCESS,2023-12-04T12:30:08.667Z,2023-12-04T12:30:12.592Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-132,EDH_PROCEDURE,SUCCESS,2023-12-04T12:32:15.987Z,2023-12-04T12:32:16.05Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2",821,MINIPROJECT
2023-12-04 12:41:01.428 +0530-133,AUDITLOG,SUCCESS,2023-12-04T12:31:01.575Z,2023-12-04T12:31:02.197Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-25,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:56.186Z,2023-12-04T12:40:56.322Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE TABLE AuditTable (
    Batch_ID STRING PRIMARY KEY, -- Unique identifier for each audit batch
    SP_Name STRING, -- Name of the stored procedure executed
    Status STRING, -- Execution status of the procedure
    Start_Time TIMESTAMP_NTZ, -- Start time of the procedure execution
    End_Time TIMESTAMP_NTZ, -- End time of the procedure execution
    Description STRING, -- Description or definition of the procedure
    SQL STRING, -- SQL query executed
    Rows_affected NUMBER, -- Number of rows affected by the query
    Executing_User STRING -- User executing the procedure
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-27,AUDITLOG,SUCCESS,2023-12-04T12:40:56.094Z,2023-12-04T12:40:56.165Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""SUBCATEGORYNAME"" AS ""SUBCATEGORYNAME"",
  MAX(""TARGETTABLE"".""MONTHYEAR"") AS ""TEMP(attr:MONTHYEAR:nk)(1035984626)(0)"",
  MIN(""TARGETTABLE"".""MONTHYEAR"") AS ""TEMP(attr:MONTHYEAR:nk)(1383166092)(0)"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  4,
  5,
  6",334,MINIPROJECT
2023-12-04 12:41:01.428 +0530-63,AUDITLOG,SUCCESS,2023-12-04T12:36:05.888Z,2023-12-04T12:36:06.457Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-64,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:05.888Z,2023-12-04T12:36:06.457Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-65,AUDITLOG,SUCCESS,2023-12-04T12:36:05.627Z,2023-12-04T12:36:05.818Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-10,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:58.627Z,2023-12-04T12:40:59.082Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-11,AUDITLOG,SUCCESS,2023-12-04T12:40:58.396Z,2023-12-04T12:40:58.575Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-66,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:05.627Z,2023-12-04T12:36:05.818Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-67,AUDITLOG,SUCCESS,2023-12-04T12:36:05.313Z,2023-12-04T12:36:05.562Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-76,AUDITLOG,SUCCESS,2023-12-04T12:35:59.997Z,2023-12-04T12:36:00.046Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-68,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:05.313Z,2023-12-04T12:36:05.562Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-69,AUDITLOG,SUCCESS,2023-12-04T12:36:04.93Z,2023-12-04T12:36:05.191Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-12,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:58.396Z,2023-12-04T12:40:58.575Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-13,AUDITLOG,SUCCESS,2023-12-04T12:40:58.119Z,2023-12-04T12:40:58.35Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-70,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:04.93Z,2023-12-04T12:36:05.191Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-28,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:56.094Z,2023-12-04T12:40:56.165Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""SUBCATEGORYNAME"" AS ""SUBCATEGORYNAME"",
  MAX(""TARGETTABLE"".""MONTHYEAR"") AS ""TEMP(attr:MONTHYEAR:nk)(1035984626)(0)"",
  MIN(""TARGETTABLE"".""MONTHYEAR"") AS ""TEMP(attr:MONTHYEAR:nk)(1383166092)(0)"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  4,
  5,
  6",334,MINIPROJECT
2023-12-04 12:41:01.428 +0530-29,AUDITLOG,SUCCESS,2023-12-04T12:39:48.861Z,2023-12-04T12:39:49.365Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-14,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:58.119Z,2023-12-04T12:40:58.35Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-15,AUDITLOG,SUCCESS,2023-12-04T12:40:57.809Z,2023-12-04T12:40:57.989Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-75,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:59.997Z,2023-12-04T12:36:00.046Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-77,AUDITLOG,SUCCESS,2023-12-04T12:35:54.827Z,2023-12-04T12:35:55.54Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","INSERT INTO SalesFact (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00
);",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-71,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:04.843Z,2023-12-04T12:36:09.096Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-16,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:57.809Z,2023-12-04T12:40:57.989Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-109,AUDITLOG,SUCCESS,2023-12-04T12:33:26.198Z,2023-12-04T12:33:27.488Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-30,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:48.861Z,2023-12-04T12:39:49.365Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-78,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:54.827Z,2023-12-04T12:35:55.54Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","INSERT INTO SalesFact (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00
);",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-79,AUDITLOG,SUCCESS,2023-12-04T12:35:27.967Z,2023-12-04T12:35:28.435Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-31,AUDITLOG,SUCCESS,2023-12-04T12:39:47.746Z,2023-12-04T12:39:48.443Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-167,AUDITLOG,SUCCESS,2023-12-04T12:30:02.933Z,2023-12-04T12:30:03.015Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-168,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:02.933Z,2023-12-04T12:30:03.015Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-169,AUDITLOG,SUCCESS,2023-12-04T12:27:58.761Z,2023-12-04T12:27:58.824Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-170,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:58.761Z,2023-12-04T12:27:58.824Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-171,AUDITLOG,SUCCESS,2023-12-04T12:27:56.491Z,2023-12-04T12:27:57.077Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-172,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:56.491Z,2023-12-04T12:27:57.077Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-173,AUDITLOG,SUCCESS,2023-12-04T12:27:55.365Z,2023-12-04T12:27:56.001Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-80,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:27.967Z,2023-12-04T12:35:28.435Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-81,AUDITLOG,SUCCESS,2023-12-04T12:35:25.516Z,2023-12-04T12:35:26.687Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-82,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:25.516Z,2023-12-04T12:35:26.687Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-83,AUDITLOG,SUCCESS,2023-12-04T12:35:24.814Z,2023-12-04T12:35:25.495Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-84,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:24.814Z,2023-12-04T12:35:25.495Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-85,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:24.334Z,2023-12-04T12:35:24.77Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-86,AUDITLOG,SUCCESS,2023-12-04T12:35:24.334Z,2023-12-04T12:35:24.77Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-88,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:24.078Z,2023-12-04T12:35:24.291Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-87,AUDITLOG,SUCCESS,2023-12-04T12:35:24.078Z,2023-12-04T12:35:24.291Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-89,AUDITLOG,SUCCESS,2023-12-04T12:35:23.849Z,2023-12-04T12:35:24.038Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-90,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:23.849Z,2023-12-04T12:35:24.038Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-91,AUDITLOG,SUCCESS,2023-12-04T12:35:23.351Z,2023-12-04T12:35:23.548Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-92,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:23.351Z,2023-12-04T12:35:23.548Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-32,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:47.746Z,2023-12-04T12:39:48.443Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-33,AUDITLOG,SUCCESS,2023-12-04T12:39:47.009Z,2023-12-04T12:39:47.724Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-93,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:23.287Z,2023-12-04T12:35:26.712Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-94,AUDITLOG,SUCCESS,2023-12-04T12:35:23.287Z,2023-12-04T12:35:26.712Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-95,AUDITLOG,SUCCESS,2023-12-04T12:35:21.256Z,2023-12-04T12:35:21.308Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-110,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:26.198Z,2023-12-04T12:33:27.488Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22149,MINIPROJECT
2023-12-04 12:41:01.428 +0530-111,AUDITLOG,SUCCESS,2023-12-04T12:33:25.478Z,2023-12-04T12:33:26.18Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-34,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:47.009Z,2023-12-04T12:39:47.724Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-96,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:21.256Z,2023-12-04T12:35:21.308Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-97,AUDITLOG,SUCCESS,2023-12-04T12:35:12.552Z,2023-12-04T12:35:13.271Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","INSERT INTO TargetTable (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00
);",22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-35,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:46.653Z,2023-12-04T12:39:46.958Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-98,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:12.552Z,2023-12-04T12:35:13.271Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","INSERT INTO TargetTable (
    OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount,
    ShipDate, DueDate, CustomerId, CustomerName,
    ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName, SubCategoryName,
    VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag,
    DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year,
    DeliveryTAT, ShipmentStatus, ProductType,
    OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
)
VALUES (
    1, '2023-12-04', 10, 25.00, 2.50,
    '2023-12-10', '2023-12-15', 101, 'John Doe',
    201, 'Product A', 'Model X', 1, 15.00, 30.00, 'Electronics', 'Gadgets',
    301, 'Vendor XYZ', '123456', 4, 1,
    'Weekday', 'Monday', 'Mon', 'Q4', '2023Q4', 12, 'December', 'Dec 2023', 49, 'Week 49', 2023,
    3, 'Shipped', 'Electronics',
    300.00, 20.00, 10.00, 310.00, 300.00
);",22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-99,AUDITLOG,SUCCESS,2023-12-04T12:35:01.809Z,2023-12-04T12:35:01.871Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('DAY',""TARGETTABLE"".""ORDERDATE"") AS ""dy:ORDERDATE:ok"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4,
  5,
  7",888,MINIPROJECT
2023-12-04 12:41:01.428 +0530-36,AUDITLOG,SUCCESS,2023-12-04T12:39:46.653Z,2023-12-04T12:39:46.958Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-134,EDH_PROCEDURE,SUCCESS,2023-12-04T12:31:01.575Z,2023-12-04T12:31:02.197Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-135,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:59.274Z,2023-12-04T12:31:00.404Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-136,AUDITLOG,SUCCESS,2023-12-04T12:30:59.274Z,2023-12-04T12:31:00.404Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-38,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:46.452Z,2023-12-04T12:39:46.605Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-37,AUDITLOG,SUCCESS,2023-12-04T12:39:46.452Z,2023-12-04T12:39:46.605Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-39,AUDITLOG,SUCCESS,2023-12-04T12:39:46.22Z,2023-12-04T12:39:46.406Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-112,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:25.478Z,2023-12-04T12:33:26.18Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-113,AUDITLOG,SUCCESS,2023-12-04T12:33:24.949Z,2023-12-04T12:33:25.43Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-40,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:46.22Z,2023-12-04T12:39:46.406Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-41,AUDITLOG,SUCCESS,2023-12-04T12:39:45.793Z,2023-12-04T12:39:46.091Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-17,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:57.749Z,2023-12-04T12:41:01.112Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-18,AUDITLOG,SUCCESS,2023-12-04T12:40:57.749Z,2023-12-04T12:41:01.112Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-114,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:24.949Z,2023-12-04T12:33:25.43Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-115,AUDITLOG,SUCCESS,2023-12-04T12:33:24.732Z,2023-12-04T12:33:24.906Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-42,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:45.793Z,2023-12-04T12:39:46.091Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-43,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:45.725Z,2023-12-04T12:39:48.461Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-116,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:24.732Z,2023-12-04T12:33:24.906Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-117,AUDITLOG,SUCCESS,2023-12-04T12:33:24.485Z,2023-12-04T12:33:24.691Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-44,AUDITLOG,SUCCESS,2023-12-04T12:39:45.725Z,2023-12-04T12:39:48.461Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-118,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:24.485Z,2023-12-04T12:33:24.691Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-45,AUDITLOG,SUCCESS,2023-12-04T12:39:45.419Z,2023-12-04T12:39:45.47Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-119,AUDITLOG,SUCCESS,2023-12-04T12:33:24.069Z,2023-12-04T12:33:24.36Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-120,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:24.069Z,2023-12-04T12:33:24.36Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-46,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:45.419Z,2023-12-04T12:39:45.47Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-47,AUDITLOG,SUCCESS,2023-12-04T12:39:44.97Z,2023-12-04T12:39:45.149Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE TABLE TargetTable (
    SeqNo INT IDENTITY(1,1) PRIMARY KEY
	
	-- Columns related to order details
    , OrderId INT
    , OrderDate DATE
    , OrderQty INT
    , UnitPrice DECIMAL(18,2)
    , UnitPriceDiscount DECIMAL(18,2)
    , ShipDate DATE
    , DueDate DATE
    , CustomerId INT
    , CustomerName VARCHAR()
	
	-- Columns related to product details
    , ProductId INT
    , ProductName VARCHAR()
    , ModelName VARCHAR()
    , MakeFlag BOOLEAN
    , StandardCost DECIMAL(18,2)
    , ListPrice DECIMAL(18,2)
    , CategoryName VARCHAR()
    , SubCategoryName VARCHAR()
	
	-- Columns related to vendor details
    , VendorID INT
    , VendorName VARCHAR()
    , VendorAccountNumber VARCHAR()
    , VendorCreditRating INT
    , VendorActiveFlag BOOLEAN
	
	-- Columns related to date and time dimensions
    , DayType VARCHAR()
    , Day VARCHAR()
    , DayShort VARCHAR()
    , Quarter VARCHAR()
    , QuarterYear VARCHAR()
    , Month INT
    , MonthName VARCHAR()
    , MonthYear VARCHAR()
    , Week INT
    , WeekName VARCHAR()
    , Year INT
	
	-- Additional columns related to delivery and shipment details
    , DeliveryTAT INT
    , ShipmentStatus VARCHAR()
    , ProductType VARCHAR()
	
	-- Financial columns
    , OrderValue DECIMAL(18,2)
    , TaxAmount DECIMAL(18,2)
    , FreightAmount DECIMAL(18,2)
    , ExtendedAmount DECIMAL(18,2)
    , SubTotal DECIMAL(18,2)
	
	-- Enterprise Data Hub (EDH) columns
    , EDH_ROW_HASH_NBR INT
    , EDH_DML_IND VARCHAR()
    , EDH_CREAT_TS DATETIME DEFAULT current_timestamp()
    , EDH_UPDT_TS DATETIME DEFAULT TO_TIMESTAMP('9999-01-01 12:00:00', 'YYYY-MM-DD HH24:MI:SS')
    , EDH_IS_C_FLG BOOLEAN
    , EDH_REPLICATION_SEQUENCE_NUMBER VARCHAR() DEFAULT '0'
    , EDH_LINEAGE_ID VARCHAR() DEFAULT '0'
    , EDH_MODIFIED_BY_USER_NAME NVARCHAR(255) DEFAULT current_user() 
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-121,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:24.011Z,2023-12-04T12:33:27.509Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-122,AUDITLOG,SUCCESS,2023-12-04T12:33:24.011Z,2023-12-04T12:33:27.509Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-48,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:44.97Z,2023-12-04T12:39:45.149Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE TABLE TargetTable (
    SeqNo INT IDENTITY(1,1) PRIMARY KEY
	
	-- Columns related to order details
    , OrderId INT
    , OrderDate DATE
    , OrderQty INT
    , UnitPrice DECIMAL(18,2)
    , UnitPriceDiscount DECIMAL(18,2)
    , ShipDate DATE
    , DueDate DATE
    , CustomerId INT
    , CustomerName VARCHAR()
	
	-- Columns related to product details
    , ProductId INT
    , ProductName VARCHAR()
    , ModelName VARCHAR()
    , MakeFlag BOOLEAN
    , StandardCost DECIMAL(18,2)
    , ListPrice DECIMAL(18,2)
    , CategoryName VARCHAR()
    , SubCategoryName VARCHAR()
	
	-- Columns related to vendor details
    , VendorID INT
    , VendorName VARCHAR()
    , VendorAccountNumber VARCHAR()
    , VendorCreditRating INT
    , VendorActiveFlag BOOLEAN
	
	-- Columns related to date and time dimensions
    , DayType VARCHAR()
    , Day VARCHAR()
    , DayShort VARCHAR()
    , Quarter VARCHAR()
    , QuarterYear VARCHAR()
    , Month INT
    , MonthName VARCHAR()
    , MonthYear VARCHAR()
    , Week INT
    , WeekName VARCHAR()
    , Year INT
	
	-- Additional columns related to delivery and shipment details
    , DeliveryTAT INT
    , ShipmentStatus VARCHAR()
    , ProductType VARCHAR()
	
	-- Financial columns
    , OrderValue DECIMAL(18,2)
    , TaxAmount DECIMAL(18,2)
    , FreightAmount DECIMAL(18,2)
    , ExtendedAmount DECIMAL(18,2)
    , SubTotal DECIMAL(18,2)
	
	-- Enterprise Data Hub (EDH) columns
    , EDH_ROW_HASH_NBR INT
    , EDH_DML_IND VARCHAR()
    , EDH_CREAT_TS DATETIME DEFAULT current_timestamp()
    , EDH_UPDT_TS DATETIME DEFAULT TO_TIMESTAMP('9999-01-01 12:00:00', 'YYYY-MM-DD HH24:MI:SS')
    , EDH_IS_C_FLG BOOLEAN
    , EDH_REPLICATION_SEQUENCE_NUMBER VARCHAR() DEFAULT '0'
    , EDH_LINEAGE_ID VARCHAR() DEFAULT '0'
    , EDH_MODIFIED_BY_USER_NAME NVARCHAR(255) DEFAULT current_user() 
);",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-49,AUDITLOG,SUCCESS,2023-12-04T12:39:34.967Z,2023-12-04T12:39:35.475Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",select * from SalesFact;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-19,AUDITLOG,SUCCESS,2023-12-04T12:40:57.456Z,2023-12-04T12:40:57.48Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT CURRENT_TIMESTAMP;,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-123,AUDITLOG,SUCCESS,2023-12-04T12:33:19.192Z,2023-12-04T12:33:19.249Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-138,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:58.527Z,2023-12-04T12:30:59.25Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-137,AUDITLOG,SUCCESS,2023-12-04T12:30:58.527Z,2023-12-04T12:30:59.25Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-139,AUDITLOG,SUCCESS,2023-12-04T12:30:58.051Z,2023-12-04T12:30:58.479Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-20,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:57.456Z,2023-12-04T12:40:57.48Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT CURRENT_TIMESTAMP;,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-21,AUDITLOG,SUCCESS,2023-12-04T12:40:57.138Z,2023-12-04T12:40:57.16Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",ALTER SESSION SET TIMEZONE = 'Asia/Kolkata';,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-140,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:58.051Z,2023-12-04T12:30:58.479Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-141,AUDITLOG,SUCCESS,2023-12-04T12:30:57.842Z,2023-12-04T12:30:58.006Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-22,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:57.138Z,2023-12-04T12:40:57.16Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",ALTER SESSION SET TIMEZONE = 'Asia/Kolkata';,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-23,AUDITLOG,SUCCESS,2023-12-04T12:40:56.679Z,2023-12-04T12:40:56.727Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE AuditLog()
    RETURNS STRING
    LANGUAGE JAVASCRIPT
    EXECUTE AS CALLER
AS
$$
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-142,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:57.842Z,2023-12-04T12:30:58.006Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-143,AUDITLOG,SUCCESS,2023-12-04T12:30:57.599Z,2023-12-04T12:30:57.798Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-144,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:57.599Z,2023-12-04T12:30:57.798Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-145,AUDITLOG,SUCCESS,2023-12-04T12:30:57.193Z,2023-12-04T12:30:57.463Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-146,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:57.193Z,2023-12-04T12:30:57.463Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-147,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:57.13Z,2023-12-04T12:31:00.421Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-148,AUDITLOG,SUCCESS,2023-12-04T12:30:57.13Z,2023-12-04T12:31:00.421Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-149,AUDITLOG,SUCCESS,2023-12-04T12:30:53.743Z,2023-12-04T12:30:53.798Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-72,AUDITLOG,SUCCESS,2023-12-04T12:36:04.843Z,2023-12-04T12:36:09.096Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-73,AUDITLOG,SUCCESS,2023-12-04T12:36:02.929Z,2023-12-04T12:36:02.962Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",SELECT * FROM TargetTable;,22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-174,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:55.365Z,2023-12-04T12:27:56.001Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-100,EDH_PROCEDURE,SUCCESS,2023-12-04T12:35:01.809Z,2023-12-04T12:35:01.871Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","SELECT ""TARGETTABLE"".""MONTHYEAR"" AS ""MONTHYEAR"",
  ""TARGETTABLE"".""PRODUCTNAME"" AS ""PRODUCTNAME"",
  DATE_PART('DAY',""TARGETTABLE"".""ORDERDATE"") AS ""dy:ORDERDATE:ok"",
  DATE_PART('MONTH',""TARGETTABLE"".""ORDERDATE"") AS ""mn:ORDERDATE:ok"",
  DATE_PART('QUARTER',""TARGETTABLE"".""ORDERDATE"") AS ""qr:ORDERDATE:ok"",
  SUM(""TARGETTABLE"".""EXTENDEDAMOUNT"") AS ""sum:EXTENDEDAMOUNT:ok"",
  DATE_PART('YEAR',""TARGETTABLE"".""ORDERDATE"") AS ""yr:ORDERDATE:ok""
FROM ""MINI_PROJECT_DB"".""PUBLIC"".""TARGETTABLE"" ""TARGETTABLE""
GROUP BY 1,
  2,
  3,
  4,
  5,
  7",888,MINIPROJECT
2023-12-04 12:41:01.428 +0530-50,EDH_PROCEDURE,SUCCESS,2023-12-04T12:39:34.967Z,2023-12-04T12:39:35.475Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",select * from SalesFact;,22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-124,EDH_PROCEDURE,SUCCESS,2023-12-04T12:33:19.192Z,2023-12-04T12:33:19.249Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-74,EDH_PROCEDURE,SUCCESS,2023-12-04T12:36:02.929Z,2023-12-04T12:36:02.962Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",SELECT * FROM TargetTable;,22150,MINIPROJECT
2023-12-04 12:41:01.428 +0530-24,EDH_PROCEDURE,SUCCESS,2023-12-04T12:40:56.679Z,2023-12-04T12:40:56.727Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE AuditLog()
    RETURNS STRING
    LANGUAGE JAVASCRIPT
    EXECUTE AS CALLER
AS
$$
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-150,EDH_PROCEDURE,SUCCESS,2023-12-04T12:30:53.743Z,2023-12-04T12:30:53.798Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-176,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.642Z,2023-12-04T12:27:55.344Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-175,AUDITLOG,SUCCESS,2023-12-04T12:27:54.642Z,2023-12-04T12:27:55.344Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-177,AUDITLOG,SUCCESS,2023-12-04T12:27:54.576Z,2023-12-04T12:27:54.601Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-178,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.576Z,2023-12-04T12:27:54.601Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-179,AUDITLOG,SUCCESS,2023-12-04T12:27:54.518Z,2023-12-04T12:27:54.537Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-180,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.518Z,2023-12-04T12:27:54.537Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-181,AUDITLOG,SUCCESS,2023-12-04T12:27:54.459Z,2023-12-04T12:27:54.48Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-182,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.459Z,2023-12-04T12:27:54.48Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-183,AUDITLOG,SUCCESS,2023-12-04T12:27:54.18Z,2023-12-04T12:27:54.297Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-184,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.18Z,2023-12-04T12:27:54.297Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-185,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:54.114Z,2023-12-04T12:27:56.018Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-186,AUDITLOG,SUCCESS,2023-12-04T12:27:54.114Z,2023-12-04T12:27:56.018Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,1,MINIPROJECT
2023-12-04 12:41:01.428 +0530-188,AUDITLOG,FAILED_WITH_ERROR,2023-12-04T12:27:53.771Z,2023-12-04T12:27:54.232Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-187,EDH_PROCEDURE,FAILED_WITH_ERROR,2023-12-04T12:27:53.771Z,2023-12-04T12:27:54.232Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                ",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-189,AUDITLOG,SUCCESS,2023-12-04T12:27:53.259Z,2023-12-04T12:27:53.725Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-190,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:53.259Z,2023-12-04T12:27:53.725Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-191,AUDITLOG,SUCCESS,2023-12-04T12:27:53.071Z,2023-12-04T12:27:53.218Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-192,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:53.071Z,2023-12-04T12:27:53.218Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-193,AUDITLOG,SUCCESS,2023-12-04T12:27:52.806Z,2023-12-04T12:27:53.027Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-194,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:52.806Z,2023-12-04T12:27:53.027Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-195,AUDITLOG,SUCCESS,2023-12-04T12:27:52.429Z,2023-12-04T12:27:52.681Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-196,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:52.429Z,2023-12-04T12:27:52.681Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future
'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate
'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate
'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact",22148,MINIPROJECT
2023-12-04 12:41:01.428 +0530-197,AUDITLOG,FAILED_WITH_ERROR,2023-12-04T12:27:52.369Z,2023-12-04T12:27:54.182Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
",CALL EDH_PROCEDURE();,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-198,EDH_PROCEDURE,FAILED_WITH_ERROR,2023-12-04T12:27:52.369Z,2023-12-04T12:27:54.182Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

",CALL EDH_PROCEDURE();,0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-199,AUDITLOG,SUCCESS,2023-12-04T12:27:51.873Z,2023-12-04T12:27:51.923Z,"
try {
	// Defines a merge query to update the AuditTable with audit information
    var mergeQuery = `
        MERGE INTO AuditTable AS T
        USING (
            SELECT
                CURRENT_TIMESTAMP() || '-' || ROW_NUMBER() OVER (ORDER BY qh.start_time DESC) AS Batch_ID, // Generates a unique Batch_ID
                p.procedure_name AS SP_Name, // Retrieves procedure name
                qh.execution_status AS Status, // Retrieves execution status
                qh.start_time AS Start_Time, // Retrieves start time of execution
                qh.end_time AS End_Time, // Retrieves end time of execution
                p.procedure_definition AS Description, // Retrieves procedure definition
                qh.QUERY_TEXT AS SQL, // Retrieves executed SQL query
                qh.ROWS_PRODUCED AS Rows_affected, // Retrieves the number of affected rows
                qh.user_name AS Executing_User // Retrieves the executing user
            FROM
                table(information_schema.query_history()) qh // Retrieves query history information
            JOIN
                information_schema.procedures p 
            ON
                p.PROCEDURE_OWNER = qh.ROLE_NAME // Joins with procedure info
            ORDER BY
                qh.start_time DESC // Orders by start time in descending order
        ) AS S
        ON T.Batch_ID = S.Batch_ID
        WHEN NOT MATCHED THEN
            INSERT (Batch_ID, SP_Name, Status, Start_Time, End_Time, Description, SQL, Rows_affected, Executing_User)
            VALUES (S.Batch_ID, S.SP_Name, S.Status, S.Start_Time, S.End_Time, S.Description, S.SQL, S.Rows_affected, S.Executing_User);
    `;

	// Executes the merge query to update the AuditTable
    var mergeStmt = snowflake.createStatement({sqlText: mergeQuery});
    mergeStmt.execute();

	// Returns success message if the procedure executed without errors
    return 'Procedure executed successfully';
} catch (err) {
	 // Returns an error message if an error occurred during execution
    return 'Error: ' + err.message;
}
","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
2023-12-04 12:41:01.428 +0530-200,EDH_PROCEDURE,SUCCESS,2023-12-04T12:27:51.873Z,2023-12-04T12:27:51.923Z,"
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

","CREATE OR REPLACE PROCEDURE EDH_PROCEDURE()
  RETURNS STRING
  LANGUAGE JAVASCRIPT
  EXECUTE AS CALLER
AS
$$
try {


	// No Transformation Section - Validates certain conditions in the date columns
    var noTransformSQL = `
        SELECT 
            CASE 
                WHEN OrderDate > CURRENT_DATE() THEN 'OrderDate cannot be in the future\n'
                ELSE ''
            END || 
            CASE 
                WHEN ShipDate < OrderDate THEN 'ShipDate cannot be before OrderDate\n'
                ELSE ''
            END || 
            CASE 
                WHEN DueDate < ShipDate THEN 'DueDate cannot be before ShipDate\n'
                ELSE ''
            END AS ValidationResults
        FROM 
            SalesFact`;
	
	// Executes SQL to check certain conditions in the data
    var stmtNoTransform = snowflake.createStatement({sqlText: noTransformSQL});
    var resultNoTransform = stmtNoTransform.execute();
    
	// Processes and formats validation results
    let validationResult = '';

    while (resultNoTransform.next()) {
        for (let i = 1; i <= resultNoTransform.getColumnCount(); i++) {
            validationResult += resultNoTransform.getColumnValue(i) + '\n'; // Fetch values directly
        }
        validationResult += '\n'; // Add extra newline for separation
    }



    // Date Transformation Section - Performs date-related transformations on the data
    var dateTransformSQL = `
        SELECT
            CASE 
                WHEN DAYOFWEEK(OrderDate) BETWEEN 2 AND 6 THEN 'Weekday' 
                ELSE 'Weekend' 
            END AS DayType
            , CASE 
                WHEN DAYNAME(OrderDate) = 'Sun' THEN 'Sunday'
                WHEN DAYNAME(OrderDate) = 'Mon' THEN 'Monday'
                WHEN DAYNAME(OrderDate) = 'Tue' THEN 'Tuesday'
                WHEN DAYNAME(OrderDate) = 'Wed' THEN 'Wednesday'
                WHEN DAYNAME(OrderDate) = 'Thu' THEN 'Thursday'
                WHEN DAYNAME(OrderDate) = 'Fri' THEN 'Friday'
                WHEN DAYNAME(OrderDate) = 'Sat' THEN 'Saturday'
            END AS Day
            , DAYNAME(OrderDate) AS DayShort
            , CASE 
                WHEN QUARTER(OrderDate) = 1 THEN 'Q1'
                WHEN QUARTER(OrderDate) = 2 THEN 'Q2'
                WHEN QUARTER(OrderDate) = 3 THEN 'Q3'
                WHEN QUARTER(OrderDate) = 4 THEN 'Q4'
            END AS Quarter
            , CONCAT(YEAR(OrderDate), '-Q'
                , CASE 
                    WHEN QUARTER(OrderDate) = 1 THEN '1'
                    WHEN QUARTER(OrderDate) = 2 THEN '2'
                    WHEN QUARTER(OrderDate) = 3 THEN '3'
                    WHEN QUARTER(OrderDate) = 4 THEN '4'
                END) AS QuarterYear
            , MONTH(OrderDate) AS Month
            , CONCAT(LEFT(MONTHNAME(OrderDate), 3), ' ', YEAR(OrderDate)) AS MonthName
            , CONCAT(YEAR(OrderDate), '-', LPAD(MONTH(OrderDate), 2, '0')) AS MonthYear
            , CEIL(DAY(OrderDate) / 7) AS Week
            , CONCAT('Wk-', CEIL(DAY(OrderDate) / 7)) AS WeekName
            , YEAR(OrderDate) AS Year
        FROM 
            SalesFact`;
	
	
	
	// Shipment Details Section - Processes shipment-related details
    var stmtDateTransform = snowflake.createStatement({ sqlText: dateTransformSQL });
    stmtDateTransform.execute();

    // Shipment Details Section
    var shipmentDetailsSQL = `
        SELECT
            DATEDIFF(DAY, OrderDate, ShipDate) AS DeliveryTAT
            , CASE 
                WHEN ShipDate < DueDate THEN 'Early'
                WHEN ShipDate = DueDate THEN 'Normal'
                ELSE 'Late'
            END AS ShipmentStatus
            , CASE 
                WHEN MakeFlag = 1 THEN 'Manufactured'
                WHEN MakeFlag = 0 THEN 'Purchased'
                ELSE 'Unknown'
            END AS ProductType
        FROM 
            SalesFact`;

	// Executes SQL for shipment-related details
    var stmtShipmentDetails = snowflake.createStatement({ sqlText: shipmentDetailsSQL });
    stmtShipmentDetails.execute();



    // Calculated Order Details Section - Computes and summarizes order-related details
    var calculatedOrderDetailsSQL = `
        WITH Transformations AS (
            SELECT
                o.SalesOrderID AS OrderId
                , o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount)) AS OrderValue
                , o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS TaxAmount
                , o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID)) AS FreightAmount
                , (o.OrderQty * (o.UnitPrice - (o.UnitPrice * o.UnitPriceDiscount))) +
                    (o.taxamt / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) +
                    (o.freight / NULLIFZERO(COUNT(o.productid) OVER (PARTITION BY o.SalesOrderID))) AS ExtendedAmount
            FROM
                Orders o
			JOIN SalesFact sf
				ON o.salesorderid = sf.orderid AND o.ProductId = sf.PRODUCTID
        ) 
        
        SELECT
            *
            , SUM(ExtendedAmount) OVER (PARTITION BY OrderId ORDER BY OrderId) AS SubTotal
        FROM
            Transformations`;

	// Executes SQL to compute order-related details
    var stmtCalculatedOrderDetails = snowflake.createStatement({ sqlText: calculatedOrderDetailsSQL });
    stmtCalculatedOrderDetails.execute();



    //EDH Columns Section
    var EDH_ROW_HASH_NBRSQL = `
                UPDATE SalesFact
                    SET EDH_ROW_HASH_NBR = hash(
                        MD5(
							// Concatenates and hashes multiple columns from SalesFact Table
                            ORDERID || '~' ||
                            TO_CHAR(ORDERDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(ORDERQTY) || '~' ||
                            TO_CHAR(UNITPRICE) || '~' ||
                            TO_CHAR(UNITPRICEDISCOUNT) || '~' ||
                            TO_CHAR(SHIPDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(DUEDATE, 'YYYYMMDD') || '~' ||
                            TO_CHAR(CUSTOMERID) || '~' ||
                            CUSTOMERNAME || '~' ||
                            TO_CHAR(PRODUCTID) || '~' ||
                            PRODUCTNAME || '~' ||
                            MODELNAME || '~' ||
                            TO_CHAR(MAKEFLAG) || '~' ||
                            TO_CHAR(STANDARDCOST) || '~' ||
                            TO_CHAR(LISTPRICE) || '~' ||
                            CATEGORYNAME || '~' ||
                            SUBCATEGORYNAME || '~' ||
                            TO_CHAR(VENDORID) || '~' ||
                            VENDORNAME || '~' ||
                            VENDORACCOUNTNUMBER || '~' ||
                            TO_CHAR(VENDORCREDITRATING) || '~' ||
                            TO_CHAR(VENDORACTIVEFLAG) || '~' ||
                            DAYTYPE || '~' ||
                            DAY || '~' ||
                            DAYSHORT || '~' ||
                            TO_CHAR(QUARTER) || '~' ||
                            TO_CHAR(QUARTERYEAR) || '~' ||
                            TO_CHAR(MONTH) || '~' ||
                            MONTHNAME || '~' ||
                            TO_CHAR(MONTHYEAR) || '~' ||
                            TO_CHAR(WEEK) || '~' ||
                            WEEKNAME || '~' ||
                            TO_CHAR(YEAR) || '~' ||
                            DELIVERYTAT || '~' ||
                            SHIPMENTSTATUS || '~' ||
                            PRODUCTTYPE || '~' ||
                            TO_CHAR(ORDERVALUE) || '~' ||
                            TO_CHAR(TAXAMOUNT) || '~' ||
                            TO_CHAR(FREIGHTAMOUNT) || '~' ||
                            TO_CHAR(EXTENDEDAMOUNT) || '~' ||
                            TO_CHAR(SUBTOTAL)
                        )
                    );
                `;

	// Executes SQL to update EDH details
    var stmtEDH_ROW_HASH_NBR = snowflake.createStatement({sqlText: EDH_ROW_HASH_NBRSQL});
    stmtEDH_ROW_HASH_NBR.execute();

 
    // Merging into TargetTable
    var merge_command = `
        MERGE INTO TargetTable AS Target
        USING (
			// Selects data from SalesFact for merging
            SELECT
                SeqNo
				
                // Columns from the No Transformation Section
                , OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice
                , CategoryName, SubCategoryName, VendorID, VendorName
                , VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				
                // Columns from the Date Transformation Section
                , DayType, Day, DayShort
				, Quarter, QuarterYear
				, Month, MonthName, MonthYear
				, Week, WeekName
                , Year
				
                // Columns from the Shipment Details Section
                , DeliveryTAT
                , ShipmentStatus
                , ProductType
				
                // Columns from the Calculated Order Details Section
                , OrderValue
                , TaxAmount
                , FreightAmount
                , ExtendedAmount
                , SubTotal

                // Columns from the EDH Section
                , EDH_ROW_HASH_NBR
                , EDH_DML_IND
                , EDH_CREAT_TS
                , EDH_UPDT_TS
                , EDH_IS_C_FLG
                , EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME
				
            FROM SalesFact
            			
            // Additional JOINs or WHERE conditions if needed
			
        ) AS Source
        ON Target.SeqNo = Source.SeqNo
        WHEN MATCHED THEN
            UPDATE SET
				// Updates existing records if matched
                SeqNo = Source.SeqNo
                , OrderId = Source.OrderId
                , OrderDate = Source.OrderDate
                , OrderQty = Source.OrderQty
                , UnitPrice = Source.UnitPrice
                , UnitPriceDiscount = Source.UnitPriceDiscount
                , ShipDate = Source.ShipDate
                , DueDate = Source.DueDate
                , CustomerId = Source.CustomerId
                , CustomerName = Source.CustomerName
                , ProductId = Source.ProductId
                , ProductName = Source.ProductName
                , ModelName = Source.ModelName
                , MakeFlag = Source.MakeFlag
                , StandardCost = Source.StandardCost
                , ListPrice = Source.ListPrice
                , CategoryName = Source.CategoryName
                , SubCategoryName = Source.SubCategoryName
                , VendorID = Source.VendorID
                , VendorName = Source.VendorName
                , VendorAccountNumber = Source.VendorAccountNumber
                , VendorCreditRating = Source.VendorCreditRating
                , VendorActiveFlag = Source.VendorActiveFlag
				
				, DayType = Source.DayType
                , Day = Source.Day
                , DayShort = Source.DayShort
                , Quarter = Source.Quarter
                , QuarterYear = Source.QuarterYear
                , Month = Source.Month
                , MonthName = Source.MonthName
                , MonthYear = Source.MonthYear
                , Week = Source.Week
                , WeekName = Source.WeekName
                , Year = Source.Year
				
				, DeliveryTAT = Source.DeliveryTAT
                , ShipmentStatus = Source.ShipmentStatus
                , ProductType = Source.ProductType
				
				, OrderValue = Source.OrderValue
                , TaxAmount = Source.TaxAmount
                , FreightAmount = Source.FreightAmount
                , ExtendedAmount = Source.ExtendedAmount
                , SubTotal = Source.SubTotal
                
                , EDH_ROW_HASH_NBR = Source.EDH_ROW_HASH_NBR
                , EDH_DML_IND = 'U'
                , EDH_CREAT_TS = Source.EDH_CREAT_TS
                , EDH_UPDT_TS = CURRENT_TIMESTAMP()
                , EDH_IS_C_FLG = 1
                , EDH_REPLICATION_SEQUENCE_NUMBER = Source.EDH_REPLICATION_SEQUENCE_NUMBER
                , EDH_LINEAGE_ID = Source.EDH_LINEAGE_ID
                , EDH_MODIFIED_BY_USER_NAME = Source.EDH_MODIFIED_BY_USER_NAME
				
				
        WHEN NOT MATCHED THEN
            INSERT (
				// Inserts new records if not matched
                SeqNo, OrderId, OrderDate, OrderQty, UnitPrice, UnitPriceDiscount
                , ShipDate, DueDate, CustomerId, CustomerName
                , ProductId, ProductName, ModelName, MakeFlag, StandardCost, ListPrice, CategoryName
                , SubCategoryName, VendorID, VendorName, VendorAccountNumber, VendorCreditRating, VendorActiveFlag
				, DayType, Day, DayShort, Quarter, QuarterYear, Month, MonthName, MonthYear, Week, WeekName, Year
				, DeliveryTAT, ShipmentStatus, ProductType
				, OrderValue, TaxAmount, FreightAmount, ExtendedAmount, SubTotal
                , EDH_ROW_HASH_NBR,EDH_DML_IND, EDH_CREAT_TS,EDH_UPDT_TS, EDH_IS_C_FLG, EDH_REPLICATION_SEQUENCE_NUMBER, EDH_LINEAGE_ID, EDH_MODIFIED_BY_USER_NAME
                )
            VALUES (
				// Values for new records
                Source.SeqNo, Source.OrderId, Source.OrderDate, Source.OrderQty, Source.UnitPrice
                , Source.UnitPriceDiscount, Source.ShipDate, Source.DueDate, Source.CustomerId, Source.CustomerName
                , Source.ProductId, Source.ProductName, Source.ModelName, Source.MakeFlag, Source.StandardCost, Source.ListPrice
                , Source.CategoryName, Source.SubCategoryName, Source.VendorID, Source.VendorName
                , Source.VendorAccountNumber, Source.VendorCreditRating, Source.VendorActiveFlag
				, Source.DayType, Source.Day, Source.DayShort, Source.Quarter, Source.QuarterYear, Source.Month, Source.MonthName, Source.MonthYear, Source.Week, Source.WeekName, Source.Year
				, Source.DeliveryTAT, Source.ShipmentStatus, Source.ProductType
				, Source.OrderValue, Source.TaxAmount, Source.FreightAmount, Source.ExtendedAmount, Source.SubTotal
                , Source.EDH_ROW_HASH_NBR, 'I', Source.EDH_CREAT_TS, Source.EDH_UPDT_TS, 0, Source.EDH_REPLICATION_SEQUENCE_NUMBER, Source.EDH_LINEAGE_ID, Source.EDH_MODIFIED_BY_USER_NAME
                );
    `;

	// Executes SQL for merging data into the TargetTable
    var mergeStmt = snowflake.createStatement({ sqlText: merge_command });
    mergeStmt.execute();

	// Returns success message if all procedures executed successfully
    return 'All procedures executed and data merged into Target Table.';
} catch (err) {
	// Handles different error codes and generates specific error messages
    let errorMessage;

    switch (err.code) {
        case 100017:
            errorMessage = 'Invalid Date Format: ' + err.message;
            break;
        case 100018:
            errorMessage = 'Missing or Incomplete Dates: ' + err.message;
            break;
        case 100:
            errorMessage = 'Data Type Mismatch Error: ' + err.message;
            break;
        case 99999:
            errorMessage = 'Unexpected Error: ' + err.message;
            break;
        case 1003:
            errorMessage = 'Object Not Found Error: ' + err.message;
            break;
        case 1004:
            errorMessage = 'Feature Not Supported Error: ' + err.message;
            break;
        case 1005:
            errorMessage = 'Resource Limit Exceeded Error: ' + err.message;
            break;
        case 10001:
            errorMessage = 'Division by Zero Error: Check for potential division by zero scenarios in your calculations.';
            break;
        case '1001':
            errorMessage = 'Error: Duplicate entry. Data already exists.';
            break;
        default:
            errorMessage = 'An error occurred: ' + err.message;
            break;
    }

    return errorMessage;
} finally {
	// Cleanup operations if required
    // Ensure the file is closed whether an error occurred or not - Resource Cleanup
    // Ensure the database connection is closed - Cleanup After Database Operations
    // Regardless of success or failure, clear the temporary data - Clearing Temporary Data
}

$$;",0,MINIPROJECT
